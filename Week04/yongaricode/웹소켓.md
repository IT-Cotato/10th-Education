## HTTP 통신

웹 환경에서는 HTTP 요청을 통해 유저, 즉 클라이언트와 서버가 상태와 데이터를 주고받는다.
HTTP는 TCP/IP 프로토콜 스택의 응용 계층에서 동작하는 프로토콜

### 방식

클라이언트가 HTTP 요청을 전송하면, 서버는 해당 데이터를 반환한다.<br/>
서버는 클라이언트의 요청이 있어야만 데이터를 응답하며, 데이터 반환 후 통신이 종료된다.

### 한계

과거에는 모든 서비스를 HTTP로 개발할 수 있었으나, 현재는 실시간 네트워킹, 대규모 사용자 처리 등 복잡한 개념이 필요함.

예를 들어, 실시간 채팅이나 게임 등이 있다.

이러한 상황을 구현하기 위해 주기적으로 서버에 요청을 보내는 방법이 사용되었습니다.

## HTTP 실시간 통신 구현 방법

HTTP는 다음 세 가지 방법으로 실시간 통신을 구현했다:

1. **Polling**: 클라이언트가 주기적으로 서버에 GET 요청을 보내고, 서버가 데이터를 응답한다. 자원 효율성이 떨어짐.
2. **Long Polling**: 서버에서 새로운 이벤트가 준비될 때까지 대기하고, 준비되면 응답한다.
3. **Streaming**: 대용량 비디오-오디오 처리에 유리하지만, 클라이언트는 첫 요청 이외에 추가 요청을 할 수 없다다.

이 모든 방법이 HTTP 통신이기에 헤더가 크다는 문제점이 있음.

## 웹소켓 프로토콜

위 문제점을 해결하기 위해 웹소켓을 사용한다.
<br/>
HTML5에서 나온 표준 기술로, TCP 기반의 양방향 통신을 지원합니다.

웹소켓을 사용하려면 핸드쉐이크를 통해 클라이언트와 서버 간의 연결을 설정해야 한다.
초기 접속은 HTTP를 사용하고, 이후 데이터 통신은 웹소켓 프로토콜을 사용합니다.

### 핸드쉐이크 과정
웹소켓 핸드쉐이크는 이 과정으로 연결됨:
1. 클라이언트가 웹소켓 연결을 위한 HTTP GET 요청을 전송
2. 서버가 요청을 통해 프로토콜을 웹소켓으로 업그레이드
3. 웹소켓이 열리면서 연결이 유지

### 핸드쉐이크 요청 헤더
요청의 헤더
- **Host**: 요청을 보낼 서버의 호스트
- **Upgrade**: 웹소켓 프로토콜로의 전환 요청
- **Connection**: 연결을 업그레이드 요청
- **WebSocket Key**: 클라이언트가 생성한 인증 키
- **Version**: 클라이언트가 지원하는 웹소켓 프로토콜 버전

### 서버의 핸드쉐이크 응답
서버는 클라이언트의 핸드쉐이크 요청에 대해 다음과 같은 헤더로 응답
- **Switching Protocols**: 프로토콜 전환 승인
- **Upgrade**: 웹소켓 프로토콜로의 전환 확인
- **Connection**: 연결이 업그레이드 되었음을 명시
- **WebSocket Accept**: 클라이언트의 인증 키 확인

### 웹소켓 연결
웹소켓으로 클라이언트와 서버는 연결
연결된 상태를 open이라고 하며, 필요 시 close를 통해 통신이 종료

### 클라이언트와 서버의 데이터 송수신
연결된 상태에서 HTTP 요청은 웹소켓 프로토콜로 전환되어 보내진다.<br/>
서버는 업데이트된 데이터를 자유롭게 전송한다.

### 데이터 전송 형식
웹소켓 통신에 사용되는 데이터는 UTF-8 인코딩을 통해 메시지 단위로 전송<br/>
데이터의 해독은 어플리케이션에서 진행


## 예시 - 코테이토 사이트
코테이토 사이트에서 웹소켓을 통해 실시간으로 문제풀이를 진행할때 소켓통신 사용된다.

관리자가 문제를 제출하면, 서버가 실시간으로 유저에게 신호를 전달하고,<br/>
유저는 제출 버튼이 활성화되는 실행을 실시간으로 받게 됨.<br/>
클라이언트의 request 요청 없이,, 이벤트가 발생한 즉시 응답이 온다!

## HTML5 이전 브라우저 지원
HTML5 이전의 브라우저에서는 웹소켓을 지원하지 않기 때문에 Socket.io, SockJS 등의 기술을 사용해 실시간 웹을 구현한다.

## Socket.io 동작 방식
Socket.io는 웹소켓을 지원하면 웹소켓 방식으로 동작하고, 

지원하지 않으면 일반 HTTP를 이용해 실시간 통신을 흉내낸다.

## 웹소켓의 한계
웹소켓 사용 시 메모리 증가와 서버 부담 등의 문제가 발생한다.

이때 WebRTC와 같은 기술을 사용해 클라이언트끼리 데이터를 송수신할 수 있도록 하는 기술도 있다.

## 결론
웹소켓은 실시간 통신에서 유용하지만,

이외에도 트래픽 양에 따른 비용 부담과 코드 복잡성 등의 단점이 있다. <br/>
고려해 필요성을 검토하고 적용하는 것이 중요

다양한 경험을 통해 웹소켓을 적극 활용해보는 것을 추천하며 마무리